# Migration Guide: Mapping Objects to Callback Facades (v1.4.7)

Ignite Element v1.4.7 introduces the callback facade pattern for `igniteCore`. Instead of providing mapping objects, you now supply `states` and `commands` callbacks. This guide shows how to migrate existing code in a few minutes.

## TL;DR

| Before | After |
| --- | --- |
| Mapping object (derived state / commands bundled) | `states(snapshot)`, `commands(actor)` callbacks |
| Render function receives `{ state, send }` | Render function receives façade values + `send` |
| Manual renderer instantiation | Pass function, `{ render }` object, or class directly |

## Step-by-step Migration

### 1. Provide Callback Facades

Wrap your derived state and command handlers inside the new callbacks:

```ts
const component = igniteCore({
  adapter: "redux",
  source: store,
  states: (snapshot) => ({ count: snapshot.counter.count }),
  commands: (store) => ({ increment: () => store.dispatch(counterSlice.actions.increment()) }),
});
```

Both callbacks should return plain objects. They run once per adapter instance (shared) or per element (isolated).

### 2. Update Render Functions

Render arguments now contain the façade result and the `send` helper. You no longer need to reach into `args.state`:

```diff
-component("counter-panel", ({ state, send }) => (
-  <button onClick={() => send({ type: "INCREMENT" })}>
-    {state.context.count}
-  </button>
-));
+component("counter-panel", ({ count, increment }) => (
+  <button onClick={increment}>
+    {count}
+  </button>
+));
```

### 3. Pass Renderers Directly

The registration function accepts render functions, objects with a `render` method, or classes:

```diff
-const renderer = new CounterRenderer();
-component("counter-panel", (args) => renderer.render(args));
+component("counter-panel", CounterRenderer);
```

### 4. Verify Shared vs. Isolated Behaviour

No changes are required to opt into shared or isolated scope. The new callbacks respect the existing adapter logic.

## TypeScript Tips

- Let TypeScript infer façade types directly from the callbacks you provide.
- If you need the raw adapter, keep using the second argument inside `commands`.

## Troubleshooting

| Symptom | Fix |
| --- | --- |
| Render args missing `count` or `increment` | Ensure `states`/`commands` return objects (not `undefined`). |
| Facade recomputes every render | Remember: callbacks run once per adapter instance/element; memoization should happen inside the callback, not the render function. |
| Class renderer not invoked | Make sure the class has a `render(args)` method. |

## Next Steps

- Update your examples/tests to exercise the new callbacks.
- Watch the changelog for renderer updates—the Ignite JSX runtime now ships by default, and you can opt into lit via `ignite.config.ts` if you prefer template literals.
- Reach out on GitHub discussions with migration questions.
